{% if settings.vip_restriction  %}
  {% assign vipCont = false %}
  {% assign customerTags = '' %}
  {% assign campaignName = '' %}
  {% assign campaignSettings = settings.vip_campaigns  | upcase  %}
  {% assign campaignEntries = campaignSettings | split: '|' %}
  {% for campaignEntry in campaignEntries %}
    {% capture campaignEntryName %}{{campaignEntry | split: ':' | last}}{% endcapture %} 
    {% capture campaignCustomerTagList %}{{campaignEntry | split: ':' | first}}{% endcapture %} 
    {% if customer  %}  
      {% assign campaignCustomerTagEntries = campaignCustomerTagList | split: ',' %}
      {% assign customerTags = customer.tags %}
      {% for campaignCustomerTagEntry in campaignCustomerTagEntries %}
        {% for tag in customer.tags %}
          {% assign customerTag = tag  | upcase  %}
          {% if customerTag == campaignCustomerTagEntry %}
            {% if campaignName == '' %}
              {% capture campaignName %}{{campaignEntryName}}{% endcapture %} 
            {% else %}
              {% capture campaignName %}{{campaignName}}, {{campaignEntryName}}{% endcapture %} 
            {% endif %}
          {% endif %}
        {% endfor %}
        
      {% endfor %}
    {% else %}  
      
    {% endif %}
  {% endfor %}
  
  {% if template contains 'page' %}
    {% if page.metafields.global.restricted %}
      {% assign content_restricted_tag = page.metafields.global.restricted | upcase %}
      {% if campaignName == content_restricted_tag %}
        {% assign content_restricted = false %}
      {% else  %} 
        {% assign content_restricted = true %}  
        {% endif %} 
      {% endif %} 
  {% endif %}

  {% if template contains 'collection' %}
    {% if collection.metafields.customer.restricted %}
      {% assign content_restricted_tag = collection.metafields.customer.restricted | upcase %}
      {% if campaignName == content_restricted_tag    %}
        {% assign content_restricted = false %}
      {% else  %} 
        {% assign content_restricted = true %}  
        {% endif %} 
      {% endif %} 
  {% endif %}

  {% if template contains 'product' %}
    {% for campaignEntry in campaignEntries %}
      {% comment %}Check if tag exist in all campaigns if yes set to restricted{% endcomment %} 
      {% capture campaignEntryName %}{{campaignEntry | split: ':' | last}}{% endcapture %} 
      {% capture campaignCustomerTagList %}{{campaignEntry | split: ':' | first}}{% endcapture %} 
      {% for tag in product.tags %}
        {% assign content_restricted_tag = tag | upcase %}
        {% if  campaignEntryName == content_restricted_tag  %}
          {% assign content_restricted = true %}
          {% break %} 
        {% endif %}   
      {% endfor %}
    {% endfor %}
    {% for tag in product.tags %}
      {% comment %}Check if tag exist in customer campaign{% endcomment %} 
      {% assign content_restricted_tag = tag | upcase %}
      {% if campaignName == content_restricted_tag  %}
        {% assign content_restricted = false %}
        {% break %} 
      {% else  %}   
      {% endif %} 
    {% endfor %}
  {% endif %}

  {% if content_restricted  %}
    <meta name="robots" content="noindex">
  {% endif %}
{% endif %} 
